<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Naptagram</title>
  <link rel="stylesheet" href="style.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(120deg, #fbc2eb, #a6c1ee);
      text-align: center;
      padding: 30px;
    }
    .app-name {
      font-family: 'Pacifico', cursive;
      font-size: 40px;
      color: #3f3f3f;
      margin-bottom: 20px;
    }
    form, .card {
      background-color: #fff;
      padding: 30px 20px;
      margin: auto;
      max-width: 350px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    input, select, button {
      display: block;
      margin: 10px auto;
      padding: 10px;
      width: 90%;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    button {
      background: linear-gradient(to right, #f953c6, #b91d73);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      opacity: 0.9;
    }
    canvas {
      margin-top: 20px;
      border: 1px solid #ddd;
    }
    h2 {
      color: #000;
      margin-bottom: 20px;
    }
    p {
      cursor: pointer;
      color: blue;
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    const app = document.getElementById("app");

    function renderPage(html) {
      app.innerHTML = html;
    }

    function renderRegister() {
      renderPage(`
        <div class="app-name">Naptagram</div>
        <h2>Register</h2>
        <form onsubmit="register(event)">
          <input type="text" id="reg_user" placeholder="User ID" required><br>
          <input type="text" id="reg_name" placeholder="Name" required><br>
          <input type="number" id="reg_age" placeholder="Age" required><br>
          <select id="reg_gender" required>
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Others">Others</option>
          </select><br>
          <input type="password" id="reg_pass" placeholder="Password" required><br>
          <button type="submit">Register</button>
          <p onclick="renderLogin()">Already have an account? Login</p>
        </form>
      `);
    }

    function renderLogin() {
      renderPage(`
        <div class="app-name">Naptagram</div>
        <h2>Login</h2>
        <form onsubmit="login(event)">
          <input type="text" id="login_user" placeholder="User ID" required><br>
          <input type="password" id="login_pass" placeholder="Password" required><br>
          <button type="submit">Login</button>
          <p onclick="renderForgotPassword()">Forgot Password?</p>
          <p onclick="renderRegister()">Don't have an account? Register</p>
        </form>
      `);
    }

    function renderForgotPassword() {
  renderPage(`
    <div class="app-name">Naptagram</div>
    <h2>Reset Password</h2>
    <form onsubmit="resetPassword(event)">
      <input type="text" id="reset_user" placeholder="Enter your User ID" required><br>
      <input type="password" id="new_password" placeholder="New Password" required><br>
      <input type="password" id="confirm_password" placeholder="Confirm New Password" required><br>
      <button type="submit">Reset Password</button>
      <p onclick="renderLogin()">Back to Login</p>
    </form>
  `);
}


function resetPassword(e) {
  e.preventDefault();
  const user = document.getElementById("reset_user").value;
  const newPass = document.getElementById("new_password").value;
  const confirmPass = document.getElementById("confirm_password").value;

  if (newPass !== confirmPass) {
    alert("Passwords do not match. Please try again.");
    return;
  }

  fetch("http://localhost:5000/api/forgot-password", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ user_id: user, new_password: newPass })
  })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        alert(data.error);
      } else {
        alert("Password reset successful!");
        renderLogin();
      }
    })
    .catch(err => {
      console.error("Error:", err);
      alert("Something went wrong. Try again later.");
    });
}


    function renderActivityForm() {
      renderPage(`
        <form onsubmit="submitActivity(event)">
          <h2>Log Activity</h2>
          <input type="text" id="activity_id" placeholder="Activity ID" required>
          <input type="text" id="activity_user_id" placeholder="User ID" required>
          <select id="activity_type" required>
            <option value="">Select Activity</option>
            <option value="swimming">Swimming</option>
            <option value="walking">Walking</option>
            <option value="running">Running</option>
            <option value="gym">Gym</option>
            <option value="cycling">Cycling</option>
            <option value="nothing">Nothing</option>
          </select>
          <input type="number" id="activity_duration" placeholder="Duration (minutes)" required>
          <button type="submit">Submit</button>
        </form>
      `);
    }

    function renderSleepSession() {
      renderPage(`
        <form onsubmit="submitSleep(event)">
          <h2>Sleep Session</h2>
          <input type="text" id="session_id" placeholder="Session ID" required>
          <input type="text" id="sleep_user_id" placeholder="User ID" required>
          <input type="date" id="sleep_date" required><br>
          <input type="number" id="sleep_duration" placeholder="Duration (hours)" required><br>
          <button type="submit">Submit Sleep</button>
        </form>
      `);
    }

    function renderPattern() {
      renderPage(`
        <div class="card">
          <h2>Behavioral Pattern</h2>
          <p>Pattern ID: P12345</p>
          <p>User ID: U45678</p>
          <button onclick="renderScore()">Check Sleep Quality</button>
        </div>
      `);
    }

    function renderRecommendation(score) {
  if (score < 20) {
    return "😴 Very low sleep quality. Try going to bed earlier and avoid caffeine after 2 PM.";
  } else if (score < 40) {
    return "📵 Try reducing screen time before bed and create a calming bedtime routine.";
  } else if (score < 60) {
    return "⏰ Consider consistent sleep schedules and avoid heavy meals late at night.";
  } else if (score < 75) {
    return "🌙 You’re doing okay! A relaxing bedtime habit or better room lighting might help.";
  } else if (score < 85) {
    return "👍 Good sleep quality! Maintain your current routine and keep stress levels low.";
  } else {
    return "🌟 Excellent sleep! Your habits are working perfectly — keep it up!";
  }
}

function renderScore() {
  const dailyScore = Math.floor(Math.random() * 100);
  const weeklyScore = Math.floor(Math.random() * 100);

  const dailyQuality =
    dailyScore >= 85 ? "Excellent" :
    dailyScore >= 75 ? "Good" :
    dailyScore >= 60 ? "Fair" :
    dailyScore >= 40 ? "Moderate" : "Poor";

  const recommendation = renderRecommendation(dailyScore);

      renderPage(`
        <div class="card">
          <h2>Daily Sleep Quality</h2>
          <div style="font-size: 32px; background: linear-gradient(to right, #f953c6, #b91d73); -webkit-background-clip: text; color: transparent; font-weight: bold;">${dailyScore}%</div>
          <p>Today's sleep quality is <strong>${dailyQuality}</strong>.</p>
          <canvas id="dailyChart" width="200" height="200"></canvas>
        </div>
        <div class="card" style="margin-top: 20px;">
          <h2>Weekly Sleep Quality</h2>
          <canvas id="weeklyChart" width="200" height="200"></canvas>
        </div>
        <div class="card" style="margin-top: 20px;">
          <button onclick="renderRecommendation(${weeklyScore})">Next</button>
        </div>
      `);

      // Daily circular chart
      const ctxDaily = document.getElementById("dailyChart").getContext("2d");
      const angleDaily = (dailyScore / 100) * 2 * Math.PI;
      ctxDaily.clearRect(0, 0, 200, 200);
      ctxDaily.beginPath();
      ctxDaily.arc(100, 100, 80, 0, 2 * Math.PI);
      ctxDaily.strokeStyle = "#eee";
      ctxDaily.lineWidth = 15;
      ctxDaily.stroke();
      ctxDaily.beginPath();
      ctxDaily.arc(100, 100, 80, -0.5 * Math.PI, angleDaily - 0.5 * Math.PI);
      ctxDaily.strokeStyle = "#f953c6";
      ctxDaily.lineWidth = 15;
      ctxDaily.stroke();
      ctxDaily.fillStyle = "#333";
      ctxDaily.font = "20px Arial";
      ctxDaily.textAlign = "center";
      ctxDaily.textBaseline = "middle";
      ctxDaily.fillText(`${dailyScore}%`, 100, 100);

      // Weekly circular chart
      const ctxWeekly = document.getElementById("weeklyChart").getContext("2d");
      const angleWeekly = (weeklyScore / 100) * 2 * Math.PI;
      ctxWeekly.clearRect(0, 0, 200, 200);
      ctxWeekly.beginPath();
      ctxWeekly.arc(100, 100, 80, 0, 2 * Math.PI);
      ctxWeekly.strokeStyle = "#eee";
      ctxWeekly.lineWidth = 15;
      ctxWeekly.stroke();
      ctxWeekly.beginPath();
      ctxWeekly.arc(100, 100, 80, -0.5 * Math.PI, angleWeekly - 0.5 * Math.PI);
      ctxWeekly.strokeStyle = "#b91d73";
      ctxWeekly.lineWidth = 15;
      ctxWeekly.stroke();
      ctxWeekly.fillStyle = "#333";
      ctxWeekly.font = "20px Arial";
      ctxWeekly.textAlign = "center";
      ctxWeekly.textBaseline = "middle";
      ctxWeekly.fillText(`${weeklyScore}%`, 100, 100);
    }

    function renderRecommendation(score) {
  let msg = "Keep up your healthy habits!";

  if (score < 20) {
    msg = "Very low sleep quality. Try going to bed earlier and avoiding caffeine in the evening.";
  } else if (score < 40) {
    msg = "Try reducing screen time before bed and create a calming bedtime routine.";
  } else if (score < 60) {
    msg = "Consider consistent sleep schedules and limit heavy meals close to bedtime.";
  } else if (score < 75) {
    msg = "You’re doing okay! Aim to improve your wind-down routine or room environment.";
  } else if (score < 85) {
    msg = "Good sleep quality! Try sticking to your current routine and avoid late-night stress.";
  } else if (score <= 100) {
    msg = "Excellent sleep! Your habits are clearly working — keep maintaining that rhythm.";
  }

      renderPage(`
        <div class="card">
          <h2>Recommendation</h2>
          <p>${msg}</p>
        </div>
        <div class="card" style="margin-top: 20px;">
          <button onclick="renderThankYou()">Next</button>
        </div>
      `);
    }

    function register(e) {
      e.preventDefault();
      alert("Registered successfully");
      renderLogin();
    }

    function renderLogout() {
      renderPage(`
        <div class="card">
          <h2>You have been logged out.</h2>
          <button onclick="renderLogin()">Login Again</button>
        </div>
      `);
    }

    function renderThankYou() {
      renderPage(`
        <div class="card">
          <h2>Thank You!</h2>
          <p>We appreciate you using Naptagram.</p>
          <button onclick="renderLogout()">Logout</button>
        </div>
      `);
    }

    function login(e) {
      e.preventDefault();
      alert("Login successful");
      renderActivityForm();
    }

    function submitActivity(e) {
      e.preventDefault();
      alert("Activity submitted");
      renderSleepSession();
    }

    function submitSleep(e) {
      e.preventDefault();
      alert("Sleep session recorded");
      renderPattern();
    }

    renderLogin();
  </script>
</body>
</html>